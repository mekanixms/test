/*

 XMS - Online Web Development

 Copyright (c) 2010 Cezar Lucan cezar.lucan@aws-dms.com
 Licensed under GPL license.
 http://www.aws-dms.com

 Date: 2010-10-24
*/
$.fn.xmlEditor=function(q){function w(b){$("#leftHandControls").width(b);y.css("margin-left",b+u);n.css("left",b+z+u)}function v(c){void 0==c&&(c=parseInt($(document).width()/4));$("#leftHandControls").width(c);n.css("height",b.outerHeight());w($("#leftHandControls").outerWidth(!0));x.outerWidth(!0)}function r(){var c=!0;b.checkedStack.forEach(function(b){1!=b.documentRef.nodeType&&(c=!1,console.info("One or more of the selected items are not DOMElements"))});return c}var b=this,A=this.get(0);b.instanceOf=
"Designer";b.version="0.4";b.releaseDate="2015-03-28";b.credentials="23";b.UId=b.instanceOf+"_"+b.get(0).nodeName.toUpperCase()+"_"+b.attr("id")+"_"+Math.ceil(1E6*Math.random());b.attr("UID",b.UId).attr("iof",b.instanceOf);b.clipboard=[];b.checkedStack=[];b.checkedStack.afterPush=function(b){console.info(this.length+" Checked elements")};b.checkedStack.afterSplice=function(b,d){console.info("checkedStack - Removed "+d+" item")};b.checkedStack.onDepleted=function(){console.info("checkedStack Depleted")};
this.rigths="";this.defaults={autoinit:!0,alterDOM:!1,name:$(this).attr("id"),id:$(this).attr("id"),dataSource:$(this).attr("dataSrc"),showDOMElementsOnly:!1,isMobile:function(){return/iphone|ipad|mobile|ipod|android|blackberry|mini|windows\sce|palm/i.test(navigator.userAgent.toLowerCase())?!0:!1},defaultRootElemOnInit:'<app outputxsl="xsl/aws2html5.xsl"/>',serverEngine:"xmlserver.php",insertNode_allowWhenForbiden:!0,acceptNodes:function(b,d){var e=g.documentMap.nodes[d.nodeName];return e?e[b]:!0},
acceptAttributes:function(b,d){var e=g.documentMap.attributes[d.nodeName];return e?e[b]:!0},documentMap:{nodes:{},attributes:{}},runtimeOptions:{showDOMElementsOnly:{name:"showDOMElementsOnly",message:"Show DOMElements only?",value:!1,type:"checkbox",alt:""},namespaceFix:{name:"namespaceFix",message:"Apply XML Stylesheet when saving document?",value:!1,type:"checkbox",alt:""},usethisstylesheet:{name:"usethisstylesheet",message:"XSL to apply when above selected",value:"xsl/namespacefix-xmldoc.xsl",
type:"text",alt:""},defaultPathOnLoad:{name:"defaultPathOnLoad",message:"Open URL default value",value:"templates/appTemplate.xml",type:"text",alt:""},newDocDefaultRootNode:{name:"newDocDefaultRootNode",message:"New document default root",value:"app",type:"text",alt:""},showThisAttributeInsteadTreeNodeName:{name:"showThisAttributeInsteadTreeNodeName",message:"Attribute value to show instead of node name in dom tree when set",value:"name",type:"text",alt:""},autoClearClipboard:{name:"autoClearClipboard",
message:"Clear clipboard automatically after paste?",value:!0,type:"checkbox",alt:""},defaultPITarget:{name:"defaultPITarget",message:"Default #PI target",value:"aws",type:"text",alt:""},displayNodesFilter:{name:"displayNodesFilter",message:"Tree nodes display filter",value:"{'remotetemplate':true, 'use':true, 'init':true, 'name':true, 'client':true, 'content':true, 'header':true, 'exec':true, 'replace':true, 'runhere':true, 'replace':true, 'case':true, 'filter':true, 'runfirst':true, 'eachnode':true, 'eachnamednode':true, 'import':true, 'advancedimport':true, 'run':true, 'eachreference':true, 'eachnamedreference':true, 'norecords':true, 'return':true, 'check':true, 'socket':true, 'data':true,'finally':true,'default':true,'parsers':true,'item':true,'callback':true,'nodelist':true,'xpath':true,'templates':true}",
type:"text",alt:"Ex: {nodeName:true, anotherNode:false}"},applyDisplayFilters:{name:"applyDisplayFilters",message:"Check this to apply above nodes tree display filter?",value:!1,type:"checkbox",alt:""},clearRecentFilesWhenLogoff:{name:"clearRecentFilesWhenLogoff",message:"Clear recent files when logoff?",value:!1,type:"checkbox",alt:""},nodeToolsAlwaysShow:{name:"nodeToolsAlwaysShow",message:"Always show node tools?",value:!0,type:"checkbox",alt:""}},treeDisplayFilter:function(c){if(b.runtimeOptions.applyDisplayFilters.value){var d=
!1;if(1==b.displayNodesFilter[c.nodeName])d=!0;else for(a in b.displayNodesFilter)0<$(a,c).length&&(d=!0)}else d=!0;return d},documentRules:{blank:{nodes:{},attributes:{}},rss:{nodes:{rss:{channel:!0},channel:{title:!0,description:!0,lastBuildDate:!0,pubDate:!0,item:!0,language:!0,copyright:!0,title:!0,managingEditor:!0,webMaster:!0,category:!0,generator:!0,docs:!0,cloud:!0,ttl:!0,image:!0,rating:!0,textInput:!0,skipHours:!0,skipDays:!0},image:{url:!0,title:!0,link:!0},textInput:{title:!0,description:!0,
link:!0,name:!0},item:{title:!0,description:!0,link:!0,author:!0,guid:!0,pubDate:!0,category:!0,content:!0,subject:!0,date:!0,type:!0,comments:!0,enclosure:!0,source:!0}},attributes:{}},userParsers:{nodes:{parsers:{item:!0},item:{alias:!0,check:!0,xpath:!0,callback:!0}},attributes:{}},lang:{nodes:{lang:{RO:!0,EN:!0,GE:!0,FR:!0,RU:!0},RO:{app:!0},EN:{app:!0},GE:{app:!0},FR:{app:!0},RU:{app:!0},app:{ui:!0,err:!0,sys:!0},ui:{message:!0},err:{message:!0},sys:{message:!0}},attributes:{app:{id:!0},message:{id:!0}}},
iptables:{nodes:{"iptables-rules":{table:!0},table:{chain:!0},chain:{rule:!0},rule:{conditions:!0,actions:!0},conditions:{match:!0,state:!0,pkttype:!0,tcp:!0,udp:!0,icmp:!0},pkttype:{"pkt-type":!0},icmp:{"icmp-type":!0},tcp:{"tcp-flags":!0,dport:!0,sport:!0},udp:{"udp-flags":!0,dport:!0,sport:!0},match:{i:!0,o:!0,s:!0,d:!0,p:!0,f:!0},state:{state:!0},actions:{ACCEPT:!0,DROP:!0,REJECT:!0,RETURN:!0,LOG:!0,NOTRACK:!0,MASQUERADE:!0,call:!0},LOG:{"log-prefix":!0}},attributes:{"iptables-rules":{version:!0},
table:{name:!0},chain:{name:!0,policy:!0,"packet-count":!0,"byte-count":!0}}},config:{nodes:{},attributes:{}},appTemplate:{nodes:{app:{name:!0,client:!0,filters:!0,templates:!0,parsers:!0,init:!0},client:{header:!0,content:!0},header:{load:!0,run:!0,title:!0,style:!0,metas:!0,links:!0,keywords:!0},metas:{element:!0},links:{element:!0},filters:{ob:!0,dom:!0},exec:{param:!0,"return":!0},"import":{filter:!0,check:!0},advancedimport:{filter:!0,check:!0,http:!0,ftp:!0,data:!0,socket:!0},xmlimport:{filter:!0,
check:!0},advancedxmlimport:{filter:!0,check:!0,http:!0,ftp:!0,data:!0,socket:!0},ob:{filter:!0},dom:{filter:!0},filter:{marker:!0,eval:!0,match:!0,matchIterator:!0,xpath:!0,nodeList:!0,domiterator:!0},parsers:{item:!0},item:{alias:!0,check:!0,xpath:!0,callback:!0},domiterator:{eachreference:!0},init:{"return":!0}},attributes:{app:{outputxsl:!0,outputdisabled:!0},"import":{source:!0,xpath:!0},advancedimport:{source:!0,xpath:!0},xmlimport:{source:!0,xpath:!0},advancedxmlimport:{source:!0,xpath:!0},
http:{method:!0,header:!0,content:!0,timeout:!0,proxy:!0,request_fulluri:!0,user_agent:!0},ftp:{method:!0,header:!0,content:!0,timeout:!0,proxy:!0,request_fulluri:!0,user_agent:!0}}}},denyNodes:function(b,d){var e=(new String(b)).toUpperCase();return"HTML"==e||"HEAD"==e?!0:!1},denyAttributes:function(b,d){return"awsuid"==(new String(b)).toLowerCase()?!0:!1},treeOptions:{multi:!0,autoclose:!1,onNodeCheckedCallback:function(c){c?b.checkedStack.contains(this)||b.checkedStack.push(this):b.checkedStack.contains(this)&&
b.checkedStack.removeItem(this)},onClick:function(c,d){var e=b.activeInXmlDoc().get(0);b.showNodeInfo(e);b.showAttributes(e);b.showTextNode(e);b.showComments(e);b.showCdata(e);b.showPIS(e)},onAddNode:function(b,d){b.get(0).documentRef=d},onBeforeExpand:function(c){b.trigger({type:"populate",which:c})},onAfterExpand:function(){},onAfterCollapse:function(c){$($("ul",c),b.nodeList).empty()},onDrag_:function(b,d){},dropOk_:function(b,d){}},windowTemplate:'<div id="xmlEditorWindow" style="textSize: 12px;"><div id="leftHandControls" class="ui-widget ui-widget-content" style="width:30%; height: 100%; float: left;"><div id="nodeListDiv" style="border: 0px; width:100%; height: 98%; float: left; overflow:auto;"><div id="nodeList_" style="width:98%; height: 98%; border: 0px;"/></div></div><fieldset id="info_" style="width:65%;  border: 0px; float: right; margin-bottom: 20px; overflow-x: auto;"><legend class="ui-corner-all ui-state-active" style="border: 1px solid;  font-weight: bold;">Element info</legend>None</fieldset><br/><fieldset id="attributes_" style="width:65%;  border: 0px; float: right; margin-bottom: 20px; overflow-x: auto;"><legend class="ui-corner-all ui-state-active" style="border: 1px solid;  font-weight: bold;">Attributes</legend>None</fieldset><br/><fieldset id="cdata_" style="width:65%;  border: 0px; float: right; margin-bottom: 20px; overflow-x: auto;"><legend class="ui-corner-all ui-state-active" style="border: 1px solid;  font-weight: bold;">CData</legend>None</fieldset><br/><fieldset id="comments_" style="width:65%;  border: 0px; float: right; margin-bottom: 20px; overflow-x: auto;"><legend class="ui-corner-all ui-state-active" style="border: 1px solid;  font-weight: bold;">Comments</legend>None</fieldset><br/><fieldset id="content_" style="width:65%;  border: 0px; float: right; margin-bottom: 20px; overflow-x: auto;"><legend class="ui-corner-all ui-state-active" style="border: 1px solid;  font-weight: bold;">Text</legend>None</fieldset><br/><fieldset id="processingInstructions_" style="width:65%;  border: 0px; float: right; margin-bottom: 20px; overflow-x: auto;"><legend class="ui-corner-all ui-state-active" style="border: 1px solid;  font-weight: bold;">ProcessingInstructions</legend>None</fieldset><br/></div>',
draggable:!1,customDragHandler:!1,resizable:!1,width:"99%",header:!0,showMainWindowCloseThick:!0,autoClearClipboard:!0,autoCreateBookmarks:!0,shortcuts:{help:{keys:"f1",message:"Help"},save:{keys:"Ctrl+s",message:"Saves the document"},open:{keys:"Ctrl+o",message:"Open a document"},"new":{keys:"Alt+Ctrl+n",message:"Create a new document"},search:{keys:"Ctrl+f",message:"Search elements in document"},rules:{keys:"Ctrl+r",message:"Load document rules"},bookmarks:{keys:"Ctrl+b",message:"Open bookmark manager"},
nodeExtend:{keys:"Ctrl+right",message:"Extend active node"},nodeCollapse:{keys:"Ctrl+left",message:"Collapse active node"},parentToggle:{keys:"Ctrl+shift+return",message:"Toggle parent node"},load:{keys:"Ctrl+l",message:"Load document source"},up:{keys:"Ctrl+up",message:"Move cursor up"},down:{keys:"Ctrl+down",message:"Move cursor down"},toggleNode:{keys:"Ctrl+return",message:"Toggle active node"},toggleSelectionActive:{keys:"Ctrl+space",message:"Select / Clear selection of active node"}},beforeSave:function(){return!0},
afterSave:function(){return!0},beforeUpdate:function(){return!0},afterUpdate:function(){return!0},beforeInsert:function(){return!0},afterInsert:function(){return!0},beforeDelete:function(b){return confirm("Really delete element '"+this.activeInXmlDoc().get(0).nodeName+"' ?")?!0:!1},afterDelete:function(){return!0},beforeProcessDataSource:function(){return!0},afterProcessDataSource:function(){return!0},rigths:!1,map:{UPDATE:"SEL",INSERT:"INS",DELETE:"DEL"},whereToCheck:{UPDATE:$(this).attr("dataSrc"),
DELETE:$(this).attr("dataSrc"),INSERT:$(this).attr("dataSrc")},check:function(b){return!0}};b.o=$.extend({},b.defaults,q);var g=b.o;b.name=b.o.name;"function"==typeof JSON.parse&&is_html_5_client()?(b.session_storage=new Database({driver:new Database.drivers.StorageDriver({name:b.instanceOf,storage:window.sessionStorage})}),b.persistent_storage=new Database({name:b.instanceOf}),q=b.persistent_storage.find({name:"runtimeOptions"}),"Array"==typeOf(q)&&0<q.length?b.runtimeOptions=q[0].content:b.runtimeOptions=
g.runtimeOptions,b.runtimeOptionsBackup=JSON.parse(JSON.stringify(g.runtimeOptions))):b.runtimeOptionsBackup=b.defaults.runtimeOptions;g.check("UPDATE");if(null!=$("config",b.rigths).html())for(keyVar in q=eval("new Object({"+$("config",b.rigths).html()+"})"),q)g[keyVar]=q[keyVar];g.settingsHandlerEnabled&&(g=$.extend({},g,eval("new Object({"+$.session.get(b.name)+"})")));b.beforeSave=g.beforeSave;b.afterSave=g.afterSave;b.beforeUpdate=g.beforeUpdate;b.afterUpdate=g.afterUpdate;b.beforeDelete=g.beforeDelete;
b.afterDelete=g.afterDelete;b.beforeInsert=g.beforeInsert;b.afterInsert=g.afterInsert;b.beforeProcessDataSource=g.beforeProcessDataSource;b.afterProcessDataSource=g.afterProcessDataSource;b.displayNodesFilter={};b.dataSource={from:g.dataSource?"initOptions":"",initOptions:g.dataSource,url:!1,documentSource:!1,newDocument:!1,fromEmbedXMLDOC:!1};b.windowTemplate=g.windowTemplate;b.windowOptions={title:b.instanceOf+" "+b.version+"-"+b.credentials+" / "+b.releaseDate,modal:!0,height:window.innerHeight-
10,width:window.innerWidth-10,draggable:g.draggable,closeOnEscape:!1,open:function(){$("#leftHandControls").height(b.height());$("#nodeListDiv").height(b.height());b.initTools();b.initKeyboardShortcuts();b.setCheckedElementsTools();b.setActiveElementsTools()},close:function(){b.runtimeOptions.clearRecentFilesWhenLogoff.value&&b.persistent_storage.find({name:"recentlyOpened"}).forEach(function(c,d,e){b.persistent_storage["delete"](c.id)});b.logoff()},beforeClose:function(){return confirm("Logoff?")},
buttons:{"New document":function(){var c=!1;do c=prompt("Please root node name:",b.runtimeOptions.newDocDefaultRootNode.value);while(/[^a-zA]/.test(c));c&&(b.dataSource.from="newDocument",b.dataSource.newDocument=c,b.processDataSource())},Open:function(){b.fileOpenDialog.dialog("open")},"Load Document Source":function(){b.loadDocumentFromSource()},View:function(){b.view({toJson:!1})},Save:function(){var c=prompt("File Name:","url"==b.dataSource.from?b.dataSource.url:"initOptions"==b.dataSource.from?
b.dataSource.initOptions:"");c&&b.save({fileName:c,keepUIDs:!1})},Search:function(){b.searchDialog.dialog("open")},"Runtime Options":function(){b.runtimeOptionsDialog.dialog("open")}}};var z=function(){var b=document.createElement("div");b.style.visibility="hidden";b.style.width="100px";b.style.msOverflowStyle="scrollbar";document.body.appendChild(b);var d=b.offsetWidth;b.style.overflow="scroll";var e=document.createElement("div");e.style.width="100%";b.appendChild(e);e=e.offsetWidth;b.parentNode.removeChild(b);
return d-e}(),n=$("#splitter"),y=$("#right"),x=$("#rightInner"),u=n.width();n.mousedown(function(){n.addClass("active");$(document).mousemove(function(b){b.pageX>=$(document).width()/6&&$(document).width()-b.pageX>=$(document).width()/2+u&&(w(b.pageX),x.outerWidth(!0))});$().add(n).add($(document)).mouseup(function(){n.removeClass("active").unbind("mouseup");$(document).unbind("mousemove").unbind("mouseup")});return!1});b.init=function(){b.dialog(b.windowOptions);b.o.showMainWindowCloseThick||($(".ui-dialog-titlebar-close").get(0).style.display=
"none");b.nodeInfo=$("#info_",b);b.nodeList=$("#nodeList_",b);b.nodeAttributes=$("#attributes_",b);b.nodeContent=$("#content_",b);b.nodeComments=$("#comments_",b);b.nodeCdata=$("#cdata_",b);b.nodeProcessingInstructions=$("#processingInstructions_",b);b.dataSourceInitialized=!1;g.dataSource||(b.dataSource.from="documentSource");window.onresize=function(){b.dialog("option","width",window.innerWidth-10).dialog("option","height",window.innerHeight-10);$("#leftHandControls").height(b.height());$("#nodeListDiv").height(b.height());
v()};v();b.dataSource.documentSource=b.o.defaultRootElemOnInit;b.processDataSource();b.o.isMobile()&&$("div#nodeListDiv").css("overflow-x","scroll").css("overflow-y","scroll")};"object"!=typeof b.runtimeOptionsDialog&&(b.runtimeOptionsDialog=$('<div><fieldset style="border: 0px;"><legend></legend><table id="runtimeOptionsDialogTable" style="width:100%;"></table></fieldset></div>').dialog({title:"Runtime options",width:600,height:400,modal:!0,autoOpen:!1,open:function(){var c="",d=0;for(which in b.runtimeOptions){console.log("Runtime options init "+
which+": "+b.runtimeOptions[which].value);switch(b.runtimeOptions[which].type){case "checkbox":c='<input type="checkbox" title="'+new String(b.runtimeOptions[which].alt)+'" name="'+which+'" '+(1==b.runtimeOptions[which].value?'checked="checked"':"")+">";break;default:c='<input type="text" title="'+new String(b.runtimeOptions[which].alt)+'" style="width:90%;" name="'+which+'" value="'+b.runtimeOptions[which].value+'">'}$("table#runtimeOptionsDialogTable",this).append("<tr "+(d%2?'class="ui-state-active"':
"")+'><td width="50%"><b>'+b.runtimeOptions[which].message+"<b/></td><td>"+c+"</td></tr>");d++}},close:function(){$("table#runtimeOptionsDialogTable",this).empty()},buttons:{Ok:function(){$("input",this).each(function(){switch(this.getAttribute("type")){case "checkbox":b.runtimeOptions[this.getAttribute("name")].value=$(this).is(":checked")?!0:!1;console.log(this.getAttribute("name")+" bool: "+($(this).is(":checked")?"checked":"off"));break;default:b.runtimeOptions[this.getAttribute("name")].value=
$(this).val(),console.log(this.getAttribute("name")+": "+$(this).val())}});if(is_html_5_client()){console.log("Saving options on local storage");var c=b.persistent_storage.find({name:"runtimeOptions"});0<c.length?b.persistent_storage.update(c[0].id,{name:"runtimeOptions",content:b.runtimeOptions}):b.persistent_storage.insert({name:"runtimeOptions",content:b.runtimeOptions})}else alert("storage not available");b.displayNodesFilter=b.runtimeOptions.applyDisplayFilters.value?eval("new Object("+b.runtimeOptions.displayNodesFilter.value+
")"):{};$(this).dialog("close")},Cancel:function(){$(this).dialog("close")},Defaults:function(){$("input",this).each(function(){switch(this.getAttribute("type")){case "checkbox":"checked"==b.runtimeOptionsBackup[this.getAttribute("name")].value?$(this).prop("checked","checked"):$(this).prop("checked",!1);break;default:$(this).val(b.runtimeOptionsBackup[this.getAttribute("name")].value)}})},"Undo changes":function(){$("input",this).each(function(){switch(this.getAttribute("type")){case "checkbox":"checked"==
b.runtimeOptions[this.getAttribute("name")].value?$(this).prop("checked","checked"):$(this).prop("checked",!1);break;default:$(this).val(b.runtimeOptions[this.getAttribute("name")].value)}})},Clear:function(){b.persistent_storage.find({name:"runtimeOptions"}).forEach(function(c,d,e){b.persistent_storage["delete"](c.id)});console.log("Designer's runtime options in persistent storage deleted");$(this).dialog("close")},"Load rules":function(){b.templateRulesSelectDialog.dialog("open")}}}));"object"!=
typeof b.searchDialog&&(b.searchDialog=$('<div id="__search__" style="font-size: 12px;"><center><fieldset style="border: 0px none ;"><table style="width: 95%; font-size: 12px;" class="ui-widget-content"><tbody><tr align="absmiddle"><td><input placeholder="CSS Query" title="CSS Query" style="width: 90%; text-align: center;" id="cssstring"/></td></tr><tr align="absmiddle"><td><input placeholder="XPath Query" title="XPath Query" style="width: 90%; text-align: center;" id="xpathstring"/></td></tr></tbody></table><br/><table style="width: 95%; font-size: 12px;" class="ui-widget-content"><tbody><tr align="left"><td><span>Code to run (function will be called by JQuery.each)</span></td></tr><tr align="absmiddle"><td><textarea style="width: 90%;" rows="5" id="runCodeSource"></textarea></td></tr></tbody></table><br/><table style="width: 95%;font-size: 12px;" class="ui-widget-content" id="results"><tbody><tr><td>None yet</td></tr></tbody></table></fieldset></center></div>').dialog({title:"Node search",
height:400,width:600,autoOpen:!1,open:function(){$("#cssstring",this).focus()},create:function(){var c=this,d=$(c).dialog("option","buttons"),e=$("#cssstring",c),f=$("#xpathstring",c),k=$("#runCodeSource",c);e.on("focus",function(){b.searchDialog.lastFocused=this});f.on("focus",function(){b.searchDialog.lastFocused=this});e.bind("keyup","return",function(){d.Search.apply(c)});f.bind("keyup","return",function(){d.Search.apply(c)});k.bind("keyup","Ctrl+return",function(){d.Run.apply(c)})},buttons:{Search:function(){var c=
b.searchDialog.lastFocused.getAttribute("id"),d=$("input#"+c,this).val();console.log("Searching for "+d);var e=$("table#results",b.searchDialog);e.html('<th><td colspan="2">Path Found for '+d+"</td></th>");d="cssstring"==c?$(d,b.xmlDoc):$(b.xmlDoc).xpe(d);d.each(function(d,k){if("cssstring"==c)var h=b.elementCSSPath({elem:$(this),useIndexes:!0});else var h=b.elementCSSPath({elem:$(this),useIndexes:!0}),l=b.elementXpath({elem:$(this),useIndexes:!0});e.append('<tr ecsspath="'+h+'"><td>#'+(d+1)+"</td><td>"+
("cssstring"==c?h:l)+"</td></tr>");$("tr[ecsspath='"+h+"']",b.searchDialog).dblclick(function(){b.extendCssPath(h)});$("tr:odd",b.searchDialog).addClass("ui-state-active")}).length;console.log("Found: "+d)},Run:function(){var c=b.searchDialog.lastFocused.getAttribute("id"),d=$("input#"+c,this).val(),c="cssstring"==c?$(d,b.xmlDoc):$(b.xmlDoc).xpe(d),e=$("textarea#runCodeSource",this).val();console.log("On: '"+d+"' running: '"+e+"'");eval("var funcToRun = function(i,e){"+unescape(e)+"};");c.each(funcToRun)},
Close:function(){$(this).dialog("close")}}}));"object"!=typeof b.fileOpenDialog&&(b.fileOpenDialog=$('<div id="fileOpenDialogWindow" align="center" style=""><input placeholder="New File" type="text" style="width:90%;;text-align: center;" id="newFile"/><select id="recentFileList" size="10" style="width:90%;text-align: center;"></select></div>').dialog({title:"Open file",modal:!0,autoOpen:!1,create:function(){var b=this,d=$(b).dialog("option","buttons"),e=$("#newFile",b),f=$("#recentFileList",b);f.on("change",
function(){e.get(0).value=$(":selected",this).get(0).textContent});e.on("focus",function(){b.lastSelected=this});f.on("focus",function(){b.lastSelected=this});e.bind("keyup","return",function(){d.Open.apply(b)});f.bind("keyup","return",function(){d.Open.apply(b)});e.bind("keyup","Ctrl+return",function(){d["New window"].apply(b)});f.bind("keyup","Ctrl+return",function(){d["New window"].apply(b)})},open:function(){b.fileOpenDialog.showFiles.apply(this);var c=$("#recentFileList",this),d=$("option",c);
0<d.length&&(d.get(0).selected=!0,this.lastSelected=c.get(0))},buttons:{Open:function(){var c=$("#newFile",this),d=$("#recentFileList",this),e=$(":selected",d);if(0<e.length&&this.lastSelected==d.get(0))var f=e.get(0).textContent;else c.get(0).value&&this.lastSelected==c.get(0)?f=c.get(0).value:alert("No file selected");f&&0!==f.length&&!/^\s*$/.test(f)&&f.trim()?(b.dataSource.from="url",b.dataSource.url=f,b.processDataSource()):alert("Seems it is a blank record");$(this).dialog("close")},"New window":function(){var b=
$("#newFile",this),d=$("#recentFileList",this),e=$(":selected",d);if(0<e.length&&this.lastSelected==d.get(0))var f=e.get(0).textContent;else b.get(0).value&&this.lastSelected==b.get(0)?f=b.get(0).value:alert("No file selected");f&&0!==f.length&&!/^\s*$/.test(f)&&f.trim()?window.open("index.php?use=templates/designer.xml&datasrc="+f,"_blank","fullscreen: 1; resizable: 1; status: 0; location: 0;",!1):alert("Seems it is a blank record");$(this).dialog("close")},Clear:function(){var c=$("#recentFileList",
this),d=$(":selected",c);0<d.length?(c=d.get(0).value,d=d.get(0).nextSibling?d.get(0).nextSibling.textContent:d.get(0).previousSibling?d.get(0).previousSibling.textContent:"",b.persistent_storage["delete"](parseInt(c)),b.fileOpenDialog.showFiles.apply(this,[d])):(b.persistent_storage.find({name:"recentlyOpened"}).forEach(function(c,d,k){b.persistent_storage["delete"](c.id)}),c=$("#recentFileList",this),b.fileOpenDialog.showFiles.apply(this))},Close:function(){$(this).dialog("close")}}}),b.fileOpenDialog.showFiles=
function(c){for(var d=this,e=$("#recentFileList",d);0<e.get(0).options.length;)e.get(0).options.remove(0);e.get(0).focus();b.persistent_storage.find({name:"recentlyOpened"}).reverse().forEach(function(b,k,h){h=d.ownerDocument.createElement("option");h.textContent=b.fileName;h.value=b.id;e.get(0).options.add(h,k);void 0!=c&&b.fileName==c&&(h.selected=!0)})});"object"!=typeof b.templateRulesSelectDialog&&(b.templateRulesSelectDialog=$('<div><fieldset style="border: 0px;"><legend>Select Document Rules</legend><select id="templateSelect" size="10" style="width: 100%;"></select></fieldset></div>').dialog({title:"Available templates",
modal:!0,open:function(){var b=$("#templateSelect",this),d=b.get(0);b.empty();for(which in g.documentRules)b=document.createElement("option"),b.text=b.value=which,d.add(b,null)},buttons:{Ok:function(){var b=$("#templateSelect",this).get(0);g.documentMap=g.documentRules[b.options[b.selectedIndex].value];console.log("Loading "+b.options[b.selectedIndex].value+" document rules");$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}));"object"!=typeof b.helpDialog&&(b.helpDialog=$('<div><fieldset style="border: 0px;"><legend>Keyboard shortcuts</legend><table id="shortcutsDisplay" style="width: 100%;"></table></fieldset><br/><center><a href="http://aws-dms.com/temp.php?use=templates/docs.designer.xml" target="_blank">More info about Designer</a></center></div>').dialog({title:"Help",
open:function(){var c=$("#shortcutsDisplay",this).get(0),d=!0;for(which in b.o.shortcuts){var e=document.createElement("tr"),f=document.createElement("td");f.appendChild(document.createTextNode(b.o.shortcuts[which].keys));var k=document.createElement("td");k.appendChild(document.createTextNode(b.o.shortcuts[which].message));e.appendChild(f);e.appendChild(k);c.appendChild(e);d&&$(e).css("background-color","#cccccc");d=!d}},buttons:{Ok:function(){$(this).dialog("close")}}}));"object"!=typeof b.insertNodeDialog&&
(b.insertNodeDialog=$('<div><center><fieldset style="border: 0px;"><table class="ui-widget-content" style="width:95%;"><tbody><tr align="absmiddle"><td><input id="tagName" style="width: 90%;text-align:center;" placeholder="Element name"></td></tr></tbody></table></fieldset><fieldset style="border: 0px;"><legend>Where</legend><table class="ui-widget-content" style="width:95%;"><tbody><tr align="absmiddle"><td style="width:30%;">Selected</td><td>Before</td><td>After</td></tr><tr align="absmiddle"><td><input type="radio" name="where" value="self" checked /></td><td style="width:30%;"><input type="radio" name="where" value="before" /></td><td><input type="radio" name="where" value="after" /></td></tr></tbody></table></fieldset><fieldset style="border: 0px;"><legend>How</legend><table class="ui-widget-content" style="width:95%;"><tbody><tr align="absmiddle"><td style="width: 30%;">Append</td><td>Prepend</td><td style="width: 50%">Replace content</td></tr><tr align="absmiddle"><td style="width: 30%"><input type="radio" name="how" value="append" checked /></td><td><input type="radio" name="how" value="prepend" /></td><td style="width: 50%"><input type="radio" name="how" value="html" /></td></tr></tbody></table></fieldset></center></div>').dialog({modal:!0,
create:function(){var b=this,d=$(b).dialog("option","buttons"),e=$("#tagName",b);e.on("focus",function(){b.lastSelected=this});e.bind("keyup","return",function(){d.Ok.apply(b)})},open:function(){$(":radio[name=where][value=self]",this).get(0).checked=!0;$(":radio[name=how][value=append]",this).get(0).checked=!0},buttons:{Ok:function(){var c=!0;$(this);var d=$("#tagName",this).val(),e=$("[name=where]:checked",this).val(),f=$("[name=how]:checked",this).val();e&&f?(b.checked().each(function(){var k=
b.checkedInXmlDoc(this).get(0);console.log("Inserting "+d+" "+e+" "+k.nodeName);var h=d.split("|");for(xx=0;xx<h.length;xx++){var l=[],h=d.split("|"),m=!1,t=h[xx].split("/");for(dd=0;dd<t.length;dd++){var p=t[dd].split("*");1==p.length&&p.push(1);for(ioai=0;ioai<p[1];ioai++)if(p[0]){m&&(k=m);if(!g.acceptNodes(p[0],k)){var q=g.documentMap.nodes[k.nodeName],n="";for(i in q)n=n+" '"+i+"'";g.insertNode_allowWhenForbiden?c=confirm("Creating node '"+p[0]+"' has been DENIED by the acceptNodes Filter; \n Allowed only: "+
n+"\n Do you still want to create it?")?!0:!1:(alert("Creating node '"+p[0]+"' has been DENIED by the acceptNodes Filter; \n Allowed only: "+n),c=!1)}g.denyNodes(p[0],k)&&(g.insertNode_allowWhenForbiden?c=confirm("Creating node '"+p[0]+"' has been DENIED by the denyNodes Filter\n Do you still want to create it?")?!0:!1:(c=!1,alert("Creating node '"+p[0]+"' has been DENIED by the denyNodes Filter")));c&&(m=b.xmlDoc.createElement(p[0]),l.push(m))}}for(de=l.length-1;0<de;de--)l[de-1].appendChild(l[de]);
if(0<l.length)switch(e){case "before":case "after":m=b.checkedInXmlDoc(this).parents("*:first").get(0);t=b.checkedInXmlDoc(this).get(0);b.insert({where:e,active:m,before:t,thisOne:l[0]});break;default:m=b.checkedInXmlDoc(this),b.insert({how:f,active:m,thisOne:l[0]})}}"self"==e?b.reloadTreeBranch(this,"self"):b.reloadTreeBranch(this)}),b.tree.kvaTree.InitKvaTree(),b.uncheckAll(),$(this).dialog("close")):alert("Select Where and How options")},Close:function(){$(this).dialog("close")}},title:"Insert new elements to selected ones"}));
"object"!=typeof b.wrapAroundNodeDialog&&(b.wrapAroundNodeDialog=$('<div><center><fieldset style="border: 0px;"><table class="ui-widget-content" style="width:95%;"><tbody><tr align="absmiddle"><td><input id="tagName" style="width: 90%;text-align:center;" placeholder="Elements separated by /"></td></tr></tbody></table></fieldset></center></div>').dialog({modal:!0,create:function(){var b=this,d=$(b).dialog("option","buttons"),e=$("#tagName",b);e.on("focus",function(){b.lastFocused=this});e.bind("keyup",
"return",function(){d.Ok.apply(b)})},buttons:{Ok:function(){var c=!0;$(this);var d=$("#tagName",this).val();b.checked().each(function(){var e=b.checkedInXmlDoc(this).get(0),f=[],k=d.split("/"),h=!1;for(dd=0;dd<k.length;dd++)if(k[dd]){h&&(e=h);if(!g.acceptNodes(k[dd],e)){var l=g.documentMap.nodes[e.nodeName],m="";for(i in l)m=m+" '"+i+"'";g.insertNode_allowWhenForbiden?c=confirm("Creating node '"+k[dd]+"' has been DENIED by the acceptNodes Filter; \n Allowed only: "+m+"\n Do you still want to create it?")?
!0:!1:(alert("Creating node '"+k[dd]+"' has been DENIED by the acceptNodes Filter; \n Allowed only: "+m),c=!1)}g.denyNodes(k[dd],e)&&(g.insertNode_allowWhenForbiden?c=confirm("Creating node '"+k[dd]+"' has been DENIED by the denyNodes Filter\n Do you still want to create it?")?!0:!1:(c=!1,alert("Creating node '"+k[dd]+"' has been DENIED by the denyNodes Filter")));c&&(h=b.xmlDoc.createElement(k[dd]),f.push(h))}e=b.checkedInXmlDoc(this).get(0);k=e.cloneNode(!0);f[f.length-1].appendChild(k);for(de=
f.length-1;0<de;de--)f[de-1].appendChild(f[de]);e.parentNode.replaceChild(f[0],e);b.reloadTreeBranch(this)});b.tree.kvaTree.InitKvaTree();b.uncheckAll();$(this).dialog("close")},Close:function(){$(this).dialog("close")}},title:"Wrap around checked ones"}));b.populateAdvancedClipboardTable=function(c){$("tr:gt(0)",c).replaceWith("");for(i=0;i<b.clipboard.length;i++)c.append('<tr><td id="nodeType" align="center">'+b.clipboard[i].nodeType+'</td><td align="center">'+b.clipboard[i].nodeName+'</td><td align="center">'+
b.clipboard[i].textContent+'</td><td style="width:20px;"><span id="delClipboardItems" class="node-tool ui-icon ui-icon-trash" title="Delete this element from clipboard" which="'+i+'"></span></td><td  style="width:20px;"><span id="pasteAdvancedClipboardItem" class="node-tool ui-icon ui-icon-clipboard" title="Paste this one to active node" which="'+i+'" ></span></td><td  style="width:20px;"><span id="pasteAdvancedClipboardItemBeforeOrAfter" class="node-tool ui-icon ui-icon-newwin" which="'+i+'" title="Paste this one before/after active node"></span></td></tr>'),
$("tr",c).filter(":last").data("linkToClip",b.clipboard[i]);$("td#nodeType",c).each(function(){switch($(this).html()){case "1":$(this).html("<strong>ELEMENT</strong>");break;case "2":$(this).html("<strong>ATTR</strong>");break;case "3":$(this).html("<strong>TEXT</strong>");break;case "4":$(this).html("<strong>CDATA</strong>");break;case "7":$(this).html("<strong>COMMENT</strong>");break;case "8":$(this).html("<strong>COMMENT</strong>")}});$("span#delClipboardItems.ui-icon-trash",c).click(function(){for(j=
0;j<b.clipboard.length;j++)if($(this).parents("tr:first").data("linkToClip")===b.clipboard[j])var c=j;b.clipboard.splice(c,1);$(this).parents("tr").replaceWith("")});$("span#pasteAdvancedClipboardItem.ui-icon-clipboard",c).click(function(){for(j=0;j<b.clipboard.length;j++)if($(this).parents("tr:first").data("linkToClip")===b.clipboard[j])var c=j;confirm("Paste the node itself (Ok) or a duplicate (Cancel)?")?b.pasteThisToActiveNode(b.clipboard[c]):b.pasteThisToActiveNode(b.clipboard[c].cloneNode(!0));
b.reloadTreeBranch(b.active().get(0),"self")});$("span#pasteAdvancedClipboardItemBeforeOrAfter.ui-icon-newwin",c).click(function(){for(j=0;j<b.clipboard.length;j++)if($(this).parents("tr:first").data("linkToClip")===b.clipboard[j])var c=j;confirm("Paste the node itself (Ok) or a duplicate (Cancel)?")?b.pasteSpecialThisToActiveNode(b.clipboard[c]):b.pasteSpecialThisToActiveNode(b.clipboard[c].cloneNode(!0));b.reloadTreeBranch(b.active().get(0))})};"object"!=typeof b.advancedClipboardDialog&&(b.advancedClipboardDialog=
$('<div><center><fieldset style="border: 0px;"><table class="ui-widget-content" style="width:95%;" id="advcliptbl"><tbody><tr><th>Type</th><th>Name</th><th>Details</th><th></th></tr></tbody></table></fieldset></center></div>').dialog({height:$(document).height()/2,width:$(document).width()/2,closeOnEscape:!0,buttons:{"Paste all":function(){b.pasteNode();b.runtimeOptions.autoClearClipboard.value&&b.clipboard.empty(!1);b.reloadTreeBranch(b.active().get(0),"self")},"Paste all before / after":function(){b.pasteSpecialNode();
b.runtimeOptions.autoClearClipboard.value&&b.clipboard.empty(!1);b.reloadTreeBranch(b.active().get(0))},"Clear clipboard":function(){b.clipboard.empty(!1)},Close:function(){$(this).dialog("close")}},title:"Advanced Clipboard",open:function(){b.populateAdvancedClipboardTable($("#advcliptbl",this))}}));"object"!=typeof b.insertDocumentFragmentDialog&&(b.insertDocumentFragmentDialog=$('<div><center><textarea type="text"  style="width:98%;"/></center><br/><fieldset style="border: 0px;"><legend>Where</legend><center><table class="ui-widget-content" style="width:95%;"><tbody><tr align="absmiddle"><td style="width:30%;">Selected</td><td>Before</td><td>After</td></tr><tr align="absmiddle"><td><input type="radio" checked="checked"  name="where" value="self"></td><td style="width:30%;"><input type="radio" name="where" value="before"></td><td><input type="radio" name="where" value="after"></td></tr></tbody></table></center></fieldset><fieldset style="border: 0px;"><legend>How</legend><center><table class="ui-widget-content" style="width:95%;"><tbody><tr align="absmiddle"><td style="width:30%;">Append</td><td>Prepend</td><td>Replace content</td></tr><tr align="absmiddle"><td><input type="radio" checked="checked"  name="how" value="append"></td><td style="width:30%;"><input type="radio" name="how" value="prepend"></td><td><input type="radio" name="how" value="html"></td></tr></tbody></table></center></fieldset></div>').dialog({height:$(document).height()/
2,width:$(document).width()/2,modal:!1,title:"Please enter document fragment source",open:function(){$(":radio[name=where][value=self]",this).get(0).checked=!0;$(":radio[name=how][value=append]",this).get(0).checked=!0;$("textarea:first",this).focus()},create:function(){var b=this,d=$(b).dialog("option","buttons"),e=$("textarea:first",b);e.on("focus",function(){b.lastFocused=this});e.bind("keyup","Ctrl+return",function(){d.Ok.apply(b)})},buttons:{Ok:function(){if($("textarea:first",this).val()){var c=
$("[name=where]:checked",this).val(),d=$("[name=how]:checked",this).val(),e=$("textarea:first",this).val(),f=$.parseXML("<dfRootElem>"+e+"</dfRootElem>").documentElement;b.checked().each(function(){var e=b.checkedInXmlDoc(this).get(0);console.log("Inserting document fragment "+c+" "+e.nodeName);for(i=0;i<f.childNodes.length;i++){var h=b.xmlDoc.importNode(f.childNodes[i],!0);switch(c){case "before":var l=e;b.checkedInXmlDoc(this).parents("*:first").get(0).insertBefore(h,l);break;case "after":l=e.nextSibling;
b.checkedInXmlDoc(this).parents("*:first").get(0).insertBefore(h,l);break;case "self":if("append"==d&&e.appendChild(h),"prepend"==d&&(l=e.firstChild,e.insertBefore(h,l)),"html"==d){for(l=e;l.hasChildNodes();)l.removeChild(l.firstChild);l.appendChild(h)}}}b.reloadTreeBranch(this,"self")})}b.uncheckAll();$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}));"object"!=typeof b.loadDocumentFromSourceDialog&&(b.loadDocumentFromSourceDialog=$('<center><textarea type="text"  style="width:95%;"/></center>').dialog({height:$(document).height()/
2,width:$(document).width()/2,modal:!0,title:"Please enter document source",open:function(){$("textarea:first",this).focus()},buttons:{Ok:function(){$("textarea:first",this).val()&&(b.dataSource.from="documentSource",b.dataSource.documentSource=$("textarea:first",this).val(),b.processDataSource());$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}));"object"!=typeof b.bookmarksDialog&&(b.bookmarksDialog=$('<div id="____bookmarks___" style="font-size: 12px;"><center><table style="width: 95%;font-size: 12px;" class="ui-widget-content" id="results"></table></center></div>').dialog({title:"Bookmarks",
height:400,width:600,open:function(){var c=$("table#results",this);c.html('<th><td colspan="3">Bookmars found:</td></th>');if("object"==typeof b.root){for(i=0;i<b.root.childNodes.length;i++)1==b.root.childNodes[i].nodeType&&"bookmarks"==b.root.childNodes[i].nodeName&&(b.bookmarks=b.root.childNodes[i]);if("object"==typeof b.bookmarks)for(j=0;j<b.bookmarks.childNodes.length;j++)1==b.bookmarks.childNodes[j].nodeType&&c.append('<tr><td width="5%">#'+(j+1)+"</td><td>"+b.bookmarks.childNodes[j].getAttribute("name")+
'</td><td width="5%" class="showElement" csspath="'+b.bookmarks.childNodes[j].textContent+'" title="Double click to jump here">Show</td></tr>');$("td.showElement",b.bookmarksDialog).dblclick(function(){b.extendCssPath(this.getAttribute("csspath"));this.innerHTML="Done!!"});$("tr:odd",this).addClass("ui-state-active")}},buttons:{Close:function(){$(this).dialog("close")}}}));b.initKeyboardShortcuts=function(){jQuery(document).bind("keydown",b.o.shortcuts.help.keys,function(c){c.stopPropagation();c.preventDefault();
b.helpDialog.dialog("open");return!1});jQuery(document).bind("keydown",b.o.shortcuts.save.keys,function(c){c.stopPropagation();c.preventDefault();(c=prompt("File Name:","url"==b.dataSource.from?b.dataSource.url:"initOptions"==b.dataSource.from?b.dataSource.initOptions:""))&&b.save({fileName:c,keepUIDs:!1});return!1});jQuery(document).bind("keydown",b.o.shortcuts.open.keys,function(c){c.stopPropagation();c.preventDefault();b.fileOpenDialog.dialog("open");return!1});jQuery(document).bind("keydown",
b.o.shortcuts["new"].keys,function(c){c.stopPropagation();c.preventDefault();if(c=prompt("Please root node name:",b.runtimeOptions.newDocDefaultRootNode.value))b.dataSource.from="newDocument",b.dataSource.newDocument=c,b.processDataSource(),console.log("Opening new document with root element: "+c);return!1});jQuery(document).bind("keydown",b.o.shortcuts.rules.keys,function(c){c.stopPropagation();c.preventDefault();b.templateRulesSelectDialog.dialog("open");return!1});jQuery(document).bind("keydown",
b.o.shortcuts.bookmarks.keys,function(c){c.stopPropagation();c.preventDefault();b.manageBookmarks();return!1});jQuery(document).bind("keydown",b.o.shortcuts.search.keys,function(c){c.stopPropagation();c.preventDefault();b.searchDialog.dialog("open");return!1});jQuery(document).bind("keydown",b.o.shortcuts.load.keys,function(c){c.stopPropagation();c.preventDefault();b.loadDocumentFromSource();return!1});jQuery(document).bind("keydown",b.o.shortcuts.down.keys,function(c){c.stopPropagation();c.preventDefault();
console.log("Moving cursor down");var d=0;$("span.text",b.tree).each(function(b){$(this).hasClass("ui-state-highlight")&&(d=b)});c=$("span.text",b.tree).get(d+1);$(c).trigger("click");$("#nodeListDiv").scrollTo(b.active().get(0));return!1});jQuery(document).bind("keydown",b.o.shortcuts.parentToggle.keys,function(c){c.stopPropagation();c.preventDefault();c=b.active().parents("li.open").first();b.reloadTreeBranch();c.children("span.text").trigger("click");return!1});jQuery(document).bind("keydown",
b.o.shortcuts.nodeExtend.keys,function(c){c.stopPropagation();c.preventDefault();c=b.activeInXmlDoc().get(0);var d=0+c.childNodes.length+" child nodes of ";b.active().hasClass("open")||(console.time("Extending "+d+"`"+c.nodeName+(1==c.nodeType?c.hasAttribute("id")?"#"+c.getAttribute("id"):"":"")+"`"),b.tree.get(0).ExpandNode(b.active()),console.timeEnd("Extending "+d+"`"+c.nodeName+(1==c.nodeType?c.hasAttribute("id")?"#"+c.getAttribute("id"):"":"")+"`"));return!1});jQuery(document).bind("keydown",
b.o.shortcuts.nodeCollapse.keys,function(c){c.stopPropagation();c.preventDefault();b.active().hasClass("open")&&(console.log("Collapsing "+b.activeInXmlDoc().get(0).nodeName),b.tree.get(0).CollapseNode(b.active()),$("#nodeListDiv").scrollTo(b.active().get(0)));return!1});jQuery(document).bind("keydown",b.o.shortcuts.up.keys,function(c){c.stopPropagation();c.preventDefault();console.log("Moving cursor up");var d=!1;$("span.text",b.tree).each(function(b){$(this).hasClass("ui-state-highlight")&&(d=b)});
d||(d=$("span.text",b.tree).length);c=$("span.text",b.tree).get(d-1);$(c).trigger("click");$("#nodeListDiv").scrollTo(b.active().get(0));return!1});jQuery(document).bind("keydown",b.o.shortcuts.toggleNode.keys,function(c){c.stopPropagation();c.preventDefault();b.tree.get(0).ToggleNode(b.active());return!1});jQuery(document).bind("keydown",b.o.shortcuts.toggleSelectionActive.keys,function(c){c.stopPropagation();c.preventDefault();$("input:checkbox:first",b.active()).trigger("click");return!1})};b.selected=
function(){return $(".open",b)};b.logoff=function(){$.ajax({url:g.serverEngine,type:"POST",async:!1,cache:!1,data:{cat:"LOGOFF"},dataType:"text",success:function(b){console.log("USER LOGGED OUT");window.location.reload()},error:function(b,d,e){alert(d)}})};b.active=function(){return $("span.ui-state-highlight",b.tree).parents("li").filter(":first")};b.activeInXmlDoc=function(){if(b.active().get(0))return $(b.active().get(0).documentRef)};b.uncheckAll=function(){console.info("Unchecking elements");
b.checked().each(function(){$(this).children("input:checkbox:first").get(0).checked=!1;b.checkedStack.removeItem(this)})};b.checked=function(){return $(b.checkedStack)};b.checkedInXmlDoc=function(b){return $($(b).get(0).documentRef)};b.view=function(c){var d=b.root.cloneNode(!0);if(!c.toJson)var e=awsNativeDOMSerializer(d);"object"!=typeof b.viewDocumentContentDialog?b.viewDocumentContentDialog=$('<center><textarea type="text"  style="width:95%;"/></center>').dialog({height:$(document).height()-100,
width:$(document).width()-100,open:function(){$("textarea:first",this).focus()},bgiFrame:!0,modal:!0,title:"Content of dataSource"}):b.viewDocumentContentDialog.dialog("open");$("textarea:first",b.viewDocumentContentDialog).val(e);c=$("textarea",b.viewDocumentContentDialog).parents(".ui-dialog-content.ui-widget-content:first").get(0);$("textarea",b.viewDocumentContentDialog).css("height",$(c).height()-30)};b.viewNode=function(){"object"!=typeof b.viewNodeDialog?b.viewNodeDialog=$('<center><textarea type="text"  style="width:95%"/></center>').dialog({height:$(document).height()-
100,width:$(document).width()-100,bgiFrame:!0,modal:!0,title:"Content of dataSource"}):b.viewNodeDialog.dialog("open");$("textarea:first",b.viewNodeDialog).val(awsNativeDOMSerializer(b.activeInXmlDoc().get(0)));var c=$("textarea",b.viewNodeDialog).parents(".ui-dialog-content.ui-widget-content:first").get(0);$("textarea",b.viewNodeDialog).css("height",$(c).height()-30)};b.insertNode=function(){b.insertNodeDialog.dialog("isOpen")&&b.insertNodeDialog.dialog("close");b.insertNodeDialog.dialog("open")};
b.wrapAroundNode=function(){b.wrapAroundNodeDialog.dialog("isOpen")&&b.wrapAroundNodeDialog.dialog("close");b.wrapAroundNodeDialog.dialog("open")};b.clipboard.afterPush=function(c){console.log("Item pushed to clipboard "+c.nodeName);console.info("Clipboard size: "+this.length);b.populateAdvancedClipboardTable($("#advcliptbl",b.advancedClipboardDialog))};b.clipboard.afterSplice=function(){console.log("Item removed from clipboard");b.populateAdvancedClipboardTable($("#advcliptbl",b.advancedClipboardDialog))};
b.clipboard.onDepleted=function(){console.log("Clipboard depleted");b.populateAdvancedClipboardTable($("#advcliptbl",b.advancedClipboardDialog))};b.cutNode=function(){var c=!1;b.checked().each(function(){c=b.checkedInXmlDoc(this);console.log("Cutting "+c.get(0).nodeName);b.clipboard.push(c.get(0));c.get(0).parentNode.removeChild(c.get(0));b.reloadTreeBranch(this)});b.uncheckAll()};b.copyNode=function(){b.checked().each(function(){var c=b.checkedInXmlDoc(this);console.log("Copy "+c.get(0).nodeName);
c=c.clone();b.clipboard.push(c.get(0))});b.uncheckAll()};b.copyChildNodes=function(){for(var c=b.checkedStack.unique(),d=function(c,d){var k=c[0].documentRef;1==k.nodeType&&(console.log("Copy child nodes of "+k.nodeName),$(k.childNodes).each(function(){var c=this.cloneNode(!0);b.clipboard.push(c)}))};c.pickOne(b.checkedStack.pickFirst,d););b.uncheckAll()};b.cutChildNodes=function(){for(var c=b.checkedStack.unique(),d=function(c,d){var k=c[0].documentRef;1==k.nodeType&&(console.log("Copy child nodes of "+
k.nodeName),$(k.childNodes).each(function(){b.clipboard.push(this);this.parentNode.removeChild(this)}))};c.pickOne(b.checkedStack.pickFirst,d););b.uncheckAll()};b.copyNodeAttributes=function(){b.checked().each(function(){var c=b.checkedInXmlDoc(this).get(0);console.log("Copy attributes of "+c.nodeName);for(i=0;i<c.attributes.length;i++)b.clipboard.push(c.attributes[i].cloneNode(!0))});b.uncheckAll()};b.pasteNode=function(){if(0<b.checkedStack.length){for(var c=b.checkedStack.unique(),d=function(c,
d){var k=this,h=c[0].documentRef;console.info("Item picked from obj.checkedStack to paste to. Items remaining: "+this.length);1==h.nodeType&&b.clipboard.forEach(function(b,c){0<k.length&&(console.info("Cloning node"),b=b.cloneNode(!0));switch(b.nodeType){default:h==b?alert("You cannot paste a cutted a node into itself. Use Copy instead of Cut!!!"):(h.appendChild(b),console.info("Paste node "+b.nodeName+" to "+h.nodeName));break;case 2:h.setAttributeNode(b),console.info("Paste attribute "+b.name+" to "+
h.nodeName)}})};c.pickOne(b.checkedStack.pickFirst,d););b.uncheckAll();b.runtimeOptions.autoClearClipboard.value&&b.clipboard.empty(!1)}else alert("No node selected")};b.pasteSpecialNode=function(){if(0<b.checkedStack.length){for(var c=b.checkedStack.unique(),d=function(c,d){var k=this,h=c[0].documentRef;console.info("Item picked from obj.checkedStack to paste to. Items remaining: "+this.length);b.clipboard.forEach(function(b,c){0<k.length&&(console.info("Cloning node"),b=b.cloneNode(!0));switch(b.nodeType){default:h==
b?alert("You cannot paste a cutted a node into itself. Use Copy instead of Cut!!!"):confirm("Paste '"+b.nodeName+"'\n   Before "+h.nodeName+": Press OK\n   After "+h.nodeName+": Press Cancel")?(h.parentNode.insertBefore(b,h),console.info("Paste "+b.nodeName+" Before "+h.nodeName)):(h.parentNode.insertBefore(b,h.nextSibling),console.info("Paste "+b.nodeName+" After "+h.nodeName));break;case 2:console.info("Paste attribute before or after DOMElement not possible")}})};c.pickOne(b.checkedStack.pickFirst,
d););b.uncheckAll();b.runtimeOptions.autoClearClipboard.value&&b.clipboard.empty(!1)}else alert("No node selected")};b.pasteThisToActiveNode=function(c){var d=b.activeInXmlDoc().get(0);switch(c.nodeType){case 1:d==c?alert("You cannot paste a cutted a node into itself. Use Copy instead of Cut!!!"):(d.appendChild(c),console.log("Paste "+c.nodeName+" to "+d.nodeName));break;case 2:d.setAttribute(c.name,c.value);console.log("Paste attribute "+c.nodeName+" to "+d.nodeName);break;default:d.appendChild(c),
console.log("Paste "+c.nodeName+" to "+d.nodeName)}b.reloadTreeBranch(b.active().get(0),"self")};b.pasteSpecialThisToActiveNode=function(c){var d=b.activeInXmlDoc().get(0);2!=c.nodeType?d==c?alert("You cannot paste a cutted a node into itself. Use Copy instead of Cut!!!"):(confirm("Paste '"+c.nodeName+"'\n   Before "+d.nodeName+": Press OK\n   After "+d.nodeName+": Press Cancel")?(console.log("Paste "+c.nodeName+" Before "+d.nodeName),d.parentNode.insertBefore(c,d)):(console.log("Paste "+c.nodeName+
" after "+d.nodeName),d.parentNode.insertBefore(c,d.nextSibling)),b.reloadTreeBranch(b.active().get(0))):alert("Attributes cannot be copied before or after an element but to the element only!")};b.advancedClipboard=function(){b.advancedClipboardDialog.dialog("isOpen")&&b.advancedClipboardDialog.dialog("close");b.advancedClipboardDialog.dialog("open")};b.deleteNode=function(c){b.checked().each(function(){var c=b.checkedInXmlDoc(this).get(0);c!=b.root?confirm("Delete node '"+c.nodeName+"' ?")&&(console.log("Deleting "+
c.nodeName),b.tree.kvaTree.DeleteNode(this),c.parentNode.removeChild(c)):alert("You cannot delete root element");b.reloadTreeBranch(this)});b.uncheckAll();return!0};b.duplicateNode=function(c){b.checked().each(function(){var c=b.checkedInXmlDoc(this).get(0);c!=b.root?(console.info("Duplicating "+c.nodeName),c.parentNode.insertBefore(c.cloneNode(!0),c)):console.log("You cannot duplicate the root element");b.reloadTreeBranch(this)});b.uncheckAll();return!0};b.deleteAttribute=function(b,d){return confirm("Really delete attribute "+
b+"?")?(console.log("Deleting attribute "+b+" of "+d.nodeName),d.removeAttribute(b),!0):!1};b.editNode=function(){if(b.active()){var c=b.activeInXmlDoc().get(0),d=prompt("New name",c.nodeName);if(d)try{var e=c.ownerDocument.createElement(d);if(1==c.nodeType&&c.hasAttributes())for(i=0;i<c.attributes.length;i++)e.setAttribute(c.attributes[i].name,c.attributes[i].value);if(1==c.nodeType&&c.hasChildNodes())for(i=0;i<c.childNodes.length;i++)e.appendChild(c.childNodes[i].cloneNode(!0));console.log("Rename node "+
c.nodeName+" as "+e.nodeName);c.parentNode.replaceChild(e,c)}catch(f){alert(f.toSource())}c==b.root?(c=b.dataSource.from,b.dataSource.from="fromEmbedXMLDOC",b.processDataSource(),b.dataSource.from=c):b.reloadTreeBranch(b.active().get(0))}};b.elementXpath=function(b){var d=[],e="",f=function(b){switch(b.nodeType){case 2:var c=b.ownerElement;break;case 1:c=b.parentNode;break;default:c=b.parentNode}var d=0,c=c.firstChild,e=1;do 1==c.nodeType&&c.nodeName==b.nodeName&&(c==b?d=e:e++);while(c=c.nextSibling);
return d};$(b.elem).parents().each(function(){1==this.nodeType&&d.unshift($(this))});d.push($(b.elem));0<d.length&&$(d).each(function(){if(b.useIndexes){var d=1==$(this).get(0).nodeType&&$(this).get(0).hasAttribute("id")&&null!=$(this).get(0).getAttribute("id")&&void 0!=$(this).get(0).getAttribute("id")?'@id="'+$(this).get(0).getAttribute("id")+'"':f($(this).get(0));e=e+"/"+$(this).get(0).nodeName+"["+d+"]"}else e=e+"/"+$(this).get(0).nodeName+"["+f($(this).get(0))+"]"});return"/"+e};b.elementCSSPath=
function(b){var d=[],e="",f=function(b){switch(b.nodeType){case 2:var c=b.ownerElement;break;case 1:c=b.parentNode;break;default:c=b.parentNode}var d=0,c=c.firstChild,e=0;do 1==c.nodeType&&c.nodeName==b.nodeName&&(c==b?d=e:e++);while(c=c.nextSibling);return d};$(b.elem).parents().each(function(){1==this.nodeType&&d.unshift($(this))});d.push($(b.elem));0<d.length&&$(d).each(function(){if(b.useIndexes){var d=1==$(this).get(0).nodeType&&$(this).get(0).hasAttribute("id")&&null!=$(this).get(0).getAttribute("id")&&
void 0!=$(this).get(0).getAttribute("id")?"#"+$(this).get(0).getAttribute("id"):":eq("+f($(this).get(0))+")";e=e+">"+$(this).get(0).nodeName+d}else e=e+">"+$(this).get(0).nodeName+":eq("+f($(this).get(0))+")"});return e.slice(1)};b.prepareDataSource=function(c){c=c?c:b.dataSourceContent;b.root=!1;b.xmlDoc=$.parseXML(c);$.isXMLDoc(b.xmlDoc)&&console.log("XML Document loaded from "+b.dataSource.from);b.root=b.xmlDoc.documentElement;if("app"==b.root.localName&&b.o.autoCreateBookmarks){for(i=0;i<b.root.childNodes.length;i++)1==
b.root.childNodes[i].nodeType&&"bookmarks"==b.root.childNodes[i].nodeName&&(b.bookmarks=b.root.childNodes[i]);"object"!=typeof b.bookmarks&&(c=b.xmlDoc.createElement("bookmarks"),b.root.appendChild(c))}if("url"==b.dataSource.from)var d=b.dataSource.url;"initOptions"==b.dataSource.from&&(d=b.dataSource.initOptions);void 0!=d&&(c=b.persistent_storage.find({name:"recentlyOpened",fileName:d}),"Array"==typeOf(c)&&0<c.length?b.persistent_storage.update(c[0].id,{name:"recentlyOpened",fileName:d,date:Date.now()}):
b.persistent_storage.insert({name:"recentlyOpened",fileName:d,date:Date.now()}),b.dialog("option","title",d));"url"!=b.dataSource.from&&"initOptions"!=b.dataSource.from&&b.dialog("option","title",b.instanceOf+" "+b.version+"-"+b.credentials+" / "+b.releaseDate)};b.buildTree=function(){b.prepareDataSource(b.dataSourceContent);0!=$("ul.domtree",b.nodeList).length&&$("ul.domtree",b.nodeList).replaceWith("");b.nodeList.append('<ul class="domtree"><li rootnode="true"><input type="checkbox" style="position:relative; left: -54px; top: -3px;"/><span style="position:relative; left: -20px; top: -4px;">'+
b.root.nodeName+'</span><ul id="'+b.root.nodeName+'"></ul></li></ul>');$("li[rootnode=true]",b.nodeList).get(0).documentRef=b.root;b.tree=$("ul.domtree",b.nodeList);b.tree.kvaTree(g.treeOptions);b.dataSourceInitialized=!0};b.showNodeInfo=function(c){b.nodeInfo.html('<legend class="ui-corner-all ui-state-active" style="border: 1px solid; font-weight: bold;">Available Information for '+c.nodeName+'</legend><div style="overflow:auto;"><table id="elementInfo" class="ui-widget ui-widget-content" style="overflow-x: auto;width:100%"><tr><td style="width:30%">Name</td><td>Value</td></tr></table></div>');
$("<tr><td>Node Name</td><td>"+c.nodeName+"</tr>").appendTo($("#elementInfo",b.nodeInfo));$("<tr><td>Node Type</td><td>"+c.nodeType+"</tr>").appendTo($("#elementInfo",b.nodeInfo));$("<tr><td>Child nodes</td><td>"+(1==c.nodeType?c.childNodes.length:"Not available")+"</tr>").appendTo($("#elementInfo",b.nodeInfo));$("<tr><td>Attributes</td><td>"+(1==c.nodeType?c.attributes.length:"Not available")+"</tr>").appendTo($("#elementInfo",b.nodeInfo));$("<tr><td>XPath</td><td>"+(1==c.nodeType?b.elementXpath({elem:c,
useIndexes:!0}):"Not available")+"</tr>").appendTo($("#elementInfo",b.nodeInfo));$("<tr><td>CSSPath</td><td>"+(1==c.nodeType?b.elementCSSPath({elem:c,useIndexes:!0}):"Not available")+"</tr>").appendTo($("#elementInfo",b.nodeInfo));$("tr:even",b.nodeInfo).each(function(){$(this).addClass("ui-state-active")})};b.showAttributes=function(c){b.nodeAttributes.html('<legend class="ui-corner-all ui-state-active" style="border: 1px solid; font-weight: bold;">Attributes for '+c.nodeName+'</legend><table id="elementAttributes" class="ui-widget ui-widget-content" style="width:100%"><tr><td style="width:30%">Name</td><td>Value</td></tr><tr><td><input type="text" value="New Attribute Name" id="newAttribute"/></td><td id="attributeValue">Value</td></tr></table>');
1==c.nodeType&&($(c.attributes).each(function(){$("#elementAttributes",b.nodeAttributes).append($('<tr><td attr="'+this.name+'">'+this.name+'</td><td id="attributeValue" title="Click to change attribute value" style="word-break:break-all;">'+this.value+"</td></tr>"));var d=$("tr:last",$("#elementAttributes",b.nodeAttributes)).get(0);b.initAttributeTools(this,d,c)}),$("#newAttribute",b.nodeAttributes).css({width:$("#newAttribute",b.nodeAttributes).parents("td:first").innerWidth()}).click(function(){$(this).val("")}).change(function(){$(this).val()?
$(this).parents("td:first").attr("attr",$(this).val()).html($(this).val()):$(this).val("New Attribute Name")}),b.showAttributes_attachEditEvent(c));$("tr:even",b.nodeAttributes).each(function(){$(this).addClass("ui-state-active")})};b.showAttributes_attachEditEvent=function(c){$("td#attributeValue",b.nodeAttributes).click(function(){var d=this.previousSibling.getAttribute("attr");if(g.acceptAttributes(d,c))if(g.denyAttributes(d,c))alert("Creating attribute '"+d+"' has been DENIED by the denyAttributes Filter");
else{var e=prompt("New value for attribute "+d,$(this).html());c.setAttribute(d,e);$(this).html(e);b.showAttributes(c)}else{var e=g.documentMap.attributes[b.active().get(0).documentRef.nodeName],f="";for(i in e)f=f+" '"+i+"'";alert("Creating attribute '"+d+"' has been DENIED by the acceptAttributes Filter;\n Allowed only: "+f)}})};b.createNodeByType=function(c,d,e){var f=!1,k=!1;if(7==d){do f=prompt("#pi Target",b.runtimeOptions.defaultPITarget.value);while(/[^a-zA]/.test(f))}switch(d){case 3:k=c.createTextNode(e);
break;case 4:k=c.createCDATASection(e);break;case 7:k=c.createProcessingInstruction(f,e);break;case 8:k=c.createComment(e)}return k};b.showNodeByType=function(c,d,e,f){var k=[],h={3:"#text",4:"#cdata-section",7:"#pi",8:"#comment"};if(1==c.nodeType)for(i=0;i<c.childNodes.length;i++)c.childNodes[i].nodeType==e&&k.push(c.childNodes[i]);else c.nodeType==e&&k.push(c);d.html('<legend title="Click to add new '+h[e]+'" class="ui-corner-all ui-state-active" style="border: 1px solid; font-weight: bold; pading: 5px;">'+
h[e]+" of "+c.nodeName+"</legend>");for(i=0;i<k.length;i++)if(k[i].nodeType==e){var g=k[i];d.append('<div id="comment_'+i+'" title="Click to edit or delete '+h[e]+'" class="ui-widget ui-widget-content comment" style="margin: 5px; min-height: 14px;">'+(null!=g||void 0!=g?g.nodeValue.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):"No Text")+"</div>");$("#comment_"+i+".comment",d).get(0).documentRef=g;$("#comment_"+i+".comment",d).click(function(){var d=this,g=$('<div><textarea style="width:98%; height: 98%"></textarea></div>').dialog({modal:!0,
height:400,width:400,title:"Edit "+h[e]+" inside "+c.nodeName,open:function(){$("textarea",this).val(d.documentRef.nodeValue).focus()},buttons:{Ok:function(){if(d.documentRef)d.documentRef.nodeValue=$("textarea:first",g).val();else{if(confirm("There is no "+ +h[e]+", would you like to create one?")){var k=b.createNodeByType(c.ownerDocument,e,$("textarea:first",this).val());c.appendChild(k)}f(c)}b.tree.kvaTree.InitKvaTree();$(this).dialog("destroy").replaceWith(" ")},Delete:function(){confirm("Really delete "+
h[e]+":\n"+d.documentRef.nodeValue+"\n?")&&(c!==d.documentRef?c.removeChild(d.documentRef):c.parentNode.removeChild(d.documentRef),f(c));$(this).dialog("destroy").replaceWith(" ")},Cancel:function(){$(this).dialog("destroy").replaceWith(" ")}}})})}$("legend.ui-state-active:first",d).click(function(){if(1==c.nodeType)var d=$('<div><textarea style="width:98%; height: 98%"></textarea></div>').dialog({modal:!0,height:400,width:400,title:"New "+h[e]+" "+c.nodeName,open:function(){$("textarea",this).focus()},
buttons:{Ok:function(){var g=$("textarea:first",d).val(),k=!0;g||confirm("No data supplied for this "+h[e]+" node. Should still be created?")||(k=!1);k&&(g=b.createNodeByType(c.ownerDocument,e,g),c.appendChild(g),b.tree.kvaTree.InitKvaTree(),f(c));$(this).dialog("destroy").replaceWith(" ")},Cancel:function(){$(this).dialog("destroy").replaceWith(" ")}}})})};b.showTextNode=function(c){b.showNodeByType(c,b.nodeContent,3,b.showTextNode)};b.showComments=function(c){b.showNodeByType(c,b.nodeComments,8,
b.showComments)};b.showCdata=function(c){b.showNodeByType(c,b.nodeCdata,4,b.showCdata)};b.showPIS=function(c){b.showNodeByType(c,b.nodeProcessingInstructions,7,b.showPIS)};b.deleteChildNodes=function(){b.checked().each(function(){if(confirm("Really delete child nodes of element "+this.textContent+"?")){var c=b.checkedInXmlDoc(this).get(0);if(c.hasChildNodes())for(;c.firstChild;)c.removeChild(c.firstChild)}b.reloadTreeBranch(this)});b.uncheckAll()};b.runCodeOnSelectedNode=function(){0<b.active().length?
"object"!=typeof b.runCodeOnSelectedNodeDialog?b.runCodeOnSelectedNodeDialog=$('<div><textarea type="text"  style="width:99%;height:98%;"/></div>').dialog({height:400,modal:!1,width:700,title:"Enter code to run on selected node",open:function(){$("textarea:first",this).focus()},buttons:{Ok:function(){var c=b.active().get(0).documentRef;eval("var funcToRun = function(i,e){"+unescape($("textarea",this).val())+"};");console.log("On: "+c.nodeName+" Running: '"+funcToRun+"'");$(c).each(funcToRun);$(this).dialog("close")},
Cancel:function(){$(this).dialog("close")}}}):b.runCodeOnSelectedNodeDialog.dialog("open"):alert("Please select a node")};b.insertDocumentFragment=function(){b.insertDocumentFragmentDialog.dialog("isOpen")&&b.insertDocumentFragmentDialog.dialog("close");b.insertDocumentFragmentDialog.dialog("open");var c=$("textarea",b.insertDocumentFragmentDialog).parents(".ui-dialog-content.ui-widget-content:first").get(0);$("textarea",b.insertDocumentFragmentDialog).css("height",$(c).height()-160)};b.loadDocumentFromSource=
function(){b.loadDocumentFromSourceDialog.dialog("isOpen")&&b.loadDocumentFromSourceDialog.dialog("close");b.loadDocumentFromSourceDialog.dialog("open");var c=$("textarea",b.loadDocumentFromSourceDialog).parents(".ui-dialog-content.ui-widget-content:first").get(0);$("textarea",b.loadDocumentFromSourceDialog).css("height",$(c).height()-30)};b.sourceDocElem=!1;b.doImport=function(){try{var c=b.active().get(0).documentRef;c.appendChild(c.ownerDocument.importNode(b.sourceDocElem,!0));alert("Document import done!!")}catch(d){alert("Source interogation failed:\n"+
d.toSource())}};b.importHTML=function(){if(0<b.active().length){var c=prompt("Please enter URL to import from:","mockup/test.html");c&&$.ajax({async:!1,url:g.serverEngine,type:"POST",data:{cat:"HTML2AWS",location:c},dataType:"xml",success:function(c){b.sourceDocElem=c.documentElement;console.time("Importing html");b.doImport();console.timeEnd("Importing html");b.reloadTreeBranch(b.active().get(0),"self")},error:function(b,c,f){console.error(f);alert("jqForms populate request "+c+":"+f+b.responseText)}})}else alert("Select a target node first!")};
b.createBookmark=function(){var c=prompt("Bookmark name",b.activeInXmlDoc().get(0).hasAttribute("name")?b.activeInXmlDoc().get(0).getAttribute("name"):b.activeInXmlDoc().get(0).hasAttribute("id")?b.activeInXmlDoc().get(0).getAttribute("id"):"");if(c&&"app"==b.root.nodeName){for(i=0;i<b.root.childNodes.length;i++)1==b.root.childNodes[i].nodeType&&"bookmarks"==b.root.childNodes[i].nodeName&&(b.bookmarks=b.root.childNodes[i]);if("object"==typeof b.bookmarks){var d=b.xmlDoc.createElement("bookmark"),
e=b.elementCSSPath({elem:$(b.activeInXmlDoc()),useIndexes:!0});d.setAttribute("name",c);d.appendChild(b.xmlDoc.createTextNode(e));b.bookmarks.appendChild(d);console.log("Bookmarking: "+e)}else alert("Bookmark element doesn't exist!! \n Please create one element with 'bookmarks' name, as a child of the root node")}};b.manageBookmarks=function(){b.bookmarksDialog.dialog("isOpen")&&b.bookmarksDialog.dialog("close");b.bookmarksDialog.dialog("open")};b.extendActive=function(){var c=b.active();0<c.length&&
(console.log("Extending active node"),c.hasClass("open")||b.tree.get(0).ExpandNode(c))};b.extendCssPath=function(c){console.time("Extending path: "+c);var d=c.split(">");$("li",b.tree).each(function(){this.documentRef===$(d[0],b.xmlDoc).get(0)&&b.tree.get(0).CollapseNode($(this))});var e="";$(d).each(function(c){e+=">"+this;var d=$(e.slice(1),b.xmlDoc).get(0);$("li",b.tree).each(function(){this.documentRef===d&&b.tree.get(0).ExpandNode($(this))})});$("li",b.tree).each(function(){this.documentRef===
$(e.slice(1),b.xmlDoc).get(0)&&$(this).children("span.text").trigger("click")});console.timeEnd("Extending path: "+c)};b.reloadTreeBranch=b.toggleNodeParent=function(c,d){null==c&&(c=b.active());if("self"==d)$(c).children("span").hasClass(".sign")&&(0<c.children("span.sign.minus").length?b.tree.get(0).redrawOpenNode(c):b.tree.get(0).redrawOpenNode($(c).parents("li.node").first()));else{var e=$(c).parents("li:first");0<e.children("span.sign.minus").length&&b.tree.get(0).redrawOpenNode(e)}};b.toggleNodeListDiv=
function(){var b=$("div#leftHandControls");v(b.outerWidth(!0))};b.setElementToolsVisibility=function(c,d){d.forEach(function(d,f){var g="",h=!1;0<c&&(h=!0);if("object"==typeof d){for(var l in d);g=l;h=Boolean(d[l].apply(b,[l]))&&h}else g=d;h?$("span.ui-icon."+g).removeClass("ui-state-disabled"):$("span.ui-icon."+g).addClass("ui-state-disabled")})};b.setActiveElementsTools=function(){b.setElementToolsVisibility(b.active().length,[{"ui-icon-cart":function(){return this.clipboard.length}},"ui-icon-pencil",
"ui-icon-comment","ui-icon-star","ui-icon-play","ui-icon-folder-open","ui-icon-transfer-e-w"])};b.setCheckedElementsTools=function(){var c=[{"ui-icon-clipboard":function(){return this.clipboard.length}},{"ui-icon-newwin":function(){return this.clipboard.length}},{"ui-icon-trash":function(){return b.checkedStack.length}},{"ui-icon-carat-2-n-s":function(){return b.checkedStack.length}},{"ui-icon-plus":r},"ui-icon-transferthick-e-w",{"ui-icon-battery-3":r},{"ui-icon-circle-minus":r},"ui-icon-scissors",
{"ui-icon-suitcase":r},"ui-icon-copy",{"ui-icon-person":r},{"ui-icon-flag":r}];b.setElementToolsVisibility(b.checked().length,c)};b.initTools=function(){var c=$('<div style="position:absolute;" id="controls">'+(b.o.isMobile()?'<span style="background-color: white;" title="TOGGLE ACTIVE" class="node-tool ui-icon ui-icon-transfer-e-w"></span>':"")+'<span style="background-color: white;" title="IMPORT HTML INTO ACTIVE NODE" class="node-tool ui-icon ui-icon-folder-open"></span><span style="background-color: white;" title="RELOAD TREE" class="node-tool ui-icon ui-icon-refresh"></span><span style="background-color: white;" title="RUN CODE ON ACTIVE NODE" class="node-tool ui-icon ui-icon-play"></span><span style="background-color: white;" title="INSERT NODE TO SELECTED" class="node-tool ui-icon ui-icon-plus"></span><span style="background-color: white;" title="WRAP AROUND SELECTED" class="node-tool ui-icon ui-icon-transferthick-e-w"></span><span style="background-color: white;" title="INSERT DOCUMENT FRAGMENT TO SELECTED" class="node-tool ui-icon ui-icon-battery-3"></span><span style="background-color: white;" title="DUPLICATE SELECTED" class="node-tool ui-icon ui-icon-carat-2-n-s"></span><span style="background-color: white;" title="DELETE SELECTED NODES" class="node-tool ui-icon ui-icon-trash"></span><span style="background-color: white;" title="DELETE CHILD NODES OF SELECTED" class="node-tool ui-icon ui-icon-circle-minus"></span><span style="background-color: white;" title="CUT SELECTED NODES" class="node-tool ui-icon ui-icon-scissors"></span><span style="background-color: white;" title="CUT CHILD NODES OF SELECTED" class="node-tool ui-icon ui-icon-suitcase"></span><span style="background-color: white;" title="COPY SELECTED NODES" class="node-tool ui-icon ui-icon-copy"></span><span style="background-color: white;" title="COPY CHILD NODES OF SELECTED" class="node-tool ui-icon ui-icon-person"></span><span style="background-color: white;" title="COPY ATTRIBUTES OF SELECTED" class="node-tool ui-icon ui-icon-flag"></span><span style="background-color: white;" title="PASTE TO SELECTED" class="node-tool ui-icon ui-icon-clipboard"></span><span style="background-color: white;" title="PASTE BEFORE / AFTER SELECTED" class="node-tool ui-icon ui-icon-newwin"></span><span style="background-color: white;" title="ADVANCED CLIPBOARD" class="node-tool ui-icon ui-icon-cart"></span><span style="background-color: white;" title="VIEW SOURCE OF ACTIVE NODE" class="node-tool ui-icon ui-icon-comment"></span><span style="background-color: white;" title="RENAME ACTIVE NODE" class="node-tool ui-icon ui-icon-pencil"></span><span style="background-color: white;" title="BOOKMARK ACTIVE NODE" class="node-tool ui-icon ui-icon-star"></span><span style="background-color: white;" title="BOOKMARKS LIST" class="node-tool ui-icon ui-icon-bookmark"></span></div>').appendTo($("#leftHandControls",
b)).hide();$("span.node-tool",c).each(function(){$(this).mouseover(function(){$(this).css("background-color","yellow")}).mouseout(function(){$(this).css("background-color","white")})});$("span.ui-icon-folder-open",c).click(function(){$(this).hasClass("ui-state-disabled")||b.importHTML()});$("span.ui-icon-refresh",c).click(function(){b.processDataSource()});$("span.ui-icon-comment",c).click(function(){$(this).hasClass("ui-state-disabled")||b.viewNode()});$("span.ui-icon-plus",c).click(function(){$(this).hasClass("ui-state-disabled")||
b.insertNode()});$("span.ui-icon-transferthick-e-w",c).click(function(){$(this).hasClass("ui-state-disabled")||b.wrapAroundNode()});$("span.ui-icon-transfer-e-w",c).click(function(){$(this).hasClass("ui-state-disabled")||b.extendActive()});$("span.ui-icon-battery-3",c).click(function(){$(this).hasClass("ui-state-disabled")||b.insertDocumentFragment()});$("span.ui-icon-scissors",c).click(function(){$(this).hasClass("ui-state-disabled")||b.cutNode()});$("span.ui-icon-copy",c).click(function(){$(this).hasClass("ui-state-disabled")||
b.copyNode()});$("span.ui-icon-person",c).click(function(){$(this).hasClass("ui-state-disabled")||(b.copyChildNodes(),b.uncheckAll())});$("span.ui-icon-suitcase",c).click(function(){$(this).hasClass("ui-state-disabled")||b.cutChildNodes()});$("span.ui-icon-flag",c).click(function(){$(this).hasClass("ui-state-disabled")||b.copyNodeAttributes()});$("span.ui-icon-clipboard",c).click(function(){$(this).hasClass("ui-state-disabled")||b.pasteNode()});$("span.ui-icon-newwin",c).click(function(){$(this).hasClass("ui-state-disabled")||
b.pasteSpecialNode()});$("span.ui-icon-cart",c).click(function(){$(this).hasClass("ui-state-disabled")||b.advancedClipboard()});$("span.ui-icon-trash",c).click(function(){$(this).hasClass("ui-state-disabled")||b.deleteNode()});$("span.ui-icon-carat-2-n-s",c).click(function(){$(this).hasClass("ui-state-disabled")||b.duplicateNode()});$("span.ui-icon-circle-minus",c).click(function(){$(this).hasClass("ui-state-disabled")||b.deleteChildNodes()});$("span.ui-icon-pencil",c).click(function(){$(this).hasClass("ui-state-disabled")||
b.editNode()});$("span.ui-icon-play",c).click(function(){$(this).hasClass("ui-state-disabled")||b.runCodeOnSelectedNode()});$("span.ui-icon-star",c).click(function(){$(this).hasClass("ui-state-disabled")||b.createBookmark()});$("span.ui-icon-bookmark",c).click(function(){b.manageBookmarks()});var d=$("#nodeListDiv",b).position();b.runtimeOptions.nodeToolsAlwaysShow.value?c.css({top:d.top+20,left:d.left,width:10,"z-index":1001}).show():($("#leftHandControls",b).mouseover(function(){c.css({top:d.top+
20,left:d.left,width:10,"z-index":1001}).show()}),$("#leftHandControls",b).mouseout(function(){c.hide()}))};b.initAttributeTools=function(c,d,e){var f=$('<div style="position:absolute; width: 10px; height: 10px;" attr="'+c.name+'"><table style="border: 0px; margin:0px; padding: 0px;"><tr><td><span style="background-color: white; text-align:center;" title="COPY ATTRIBUTE <br/>'+c.name+' of  this NODE " class="node-tool ui-icon ui-icon-copy"></span></td><td><span style="background-color: white; text-align:center;" title="CUT ATTRIBUTE <br/>'+
c.name+' of  this NODE " class="node-tool ui-icon ui-icon-scissors"></span></td><td><span style="background-color: white; text-align:center;" title="DELETES ATTRIBUTE <br/>'+c.name+' of  this NODE " class="node-tool ui-icon ui-icon-trash"></span></td></tr></table></div>');f.appendTo($("td[attr="+c.name+"]",b.nodeAttributes)).hide();$("span.node-tool",f).each(function(){$(this).mouseover(function(){$(this).css({"background-color":"red"})}).mouseout(function(){$(this).css({"background-color":"white"})}).addClass("ui-icon")});
$("span.ui-icon-trash",f).click(function(){b.deleteAttribute(c.name,e)&&($("div[attr="+c.name+"]",b.nodeAttributes).replaceWith(""),$(d).replaceWith(),b.showAttributes(e))});$("span.ui-icon-copy",f).click(function(){b.clipboard.push(c.cloneNode(!0));b.populateAdvancedClipboardTable($("#advcliptbl",b.advancedClipboardDialog))});$("span.ui-icon-scissors",f).click(function(){b.clipboard.push(c);$("div[attr="+c.name+"]",b.nodeAttributes).replaceWith("");e.removeAttributeNode(c);b.showAttributes(e);b.populateAdvancedClipboardTable($("#advcliptbl",
b.advancedClipboardDialog))});$("td:eq(0)",d).mouseover(function(){f.css({top:$(d).position().top-f.height()+6,left:$(d).position().left+$("td[attr="+c.name+"]",b.nodeAttributes).width()-60}).show()});$("td:eq(0)",d).mouseout(function(){f.hide()})};$(document).bind("click",function(){b.setCheckedElementsTools();b.setActiveElementsTools()});b.processDataSourceCallback=function(c){switch(b.dataSource.from){case "initOptions":$.ajax({async:!1,url:g.serverEngine,type:"POST",data:{cat:"DATA_IMPORT",location:g.dataSource},
dataType:"xml",success:function(c){b.dataSourceContent=awsNativeDOMSerializer(c);b.buildTree()},error:function(b,c,f){alert("jqForms populate request "+c+":"+f+b.responseText)}});break;case "fromEmbedXMLDOC":b.dataSourceContent=awsNativeDOMSerializer(b.xmlDoc);b.buildTree();break;case "documentSource":b.dataSourceContent=b.dataSource.documentSource;b.buildTree();break;case "newDocument":b.dataSourceContent="<"+b.dataSource.newDocument+"/>";b.buildTree();break;case "url":$.ajax({async:!1,url:g.serverEngine,
type:"POST",data:{cat:"DATA_IMPORT",location:b.dataSource.url},dataType:"text",success:function(c){b.dataSourceContent=c;b.buildTree()},error:function(b,c,f){alert("jqForms populate request "+c+":"+f+b.responseText)}})}return!0};b.on("processDataSource",function(c){var d=b.processDataSourceCallback,e=!0;"true"==b.attr("rCheck")&&(g.check("UPDATE")||(e=!1));e?b.beforeProcessDataSource.apply(b)&&d.apply(b,[c])&&($(document).trigger({type:"processDataSourceDone",entityId:b.UId}),b.afterProcessDataSource.apply(b)):
alert("jqForms: processDataSource not allowed")});b.processDataSource=function(c){b.checkedStack.empty(!1);c=$.extend({},{type:"processDataSource"},c);b.trigger(c)};b.saveCallback=function(c){var d=b.root.cloneNode(!0);if(!c.toJson)var e=awsNativeDOMSerializer(d);$.ajax({async:!1,url:g.serverEngine+"?"+$.param({cat:"SAVE_FILE_FROM_POST",location:c.fileName,namespaceFix:"checked"==b.runtimeOptions.namespaceFix.value?"true":"false",usethisstylesheet:b.runtimeOptions.usethisstylesheet.value}),type:"POST",
data:e,contentType:"text/xml",cache:!1,dataType:"xml",success:function(b){console.log("Saving document status: "+b.documentElement.textContent);alert(b.documentElement.textContent)},error:function(b,c,d){alert("jqForms populate request "+c+":"+d+b.responseText)}});return!0};b.on("save",function(c){var d=b.saveCallback,e=!0;"true"==b.attr("rCheck")&&(g.check("SAVE")||(e=!1));e?b.beforeSave.apply(b)&&d.apply(b,[c])&&($(document).trigger({type:"savedone",entityId:b.UId}),b.afterSave.apply(b)):alert("jqForms: Save not allowed")});
b.save=function(c){c=$.extend({},{type:"save"},c);b.trigger(c)};b.deleteCallback=function(c){var d=b.activeInXmlDoc().get(0);d!=b.root?(d.parentNode.removeChild(d),b.tree.kvaTree.DeleteNode(c.which)):alert("You cannot delete root element of the document");return!0};b.bind("delete",function(c){var d=b.deleteCallback,e=!0;"true"==b.attr("rCheck")&&(g.check("DELETE")||(e=!1));e?b.beforeDelete.apply(b,[c])&&d.apply(b,[c])&&($(document).trigger({type:"deletedone",entityId:b.UId}),b.afterDelete.apply(b)):
alert("jqForms: DELETE not allowed")});b.del=function(c){c=$.extend({},{type:"delete"},c);b.trigger(c)};b.insertCallback=function(b){switch(b.where){case "before":b.active.insertBefore(b.thisOne,b.before);break;case "after":b.active.insertBefore(b.thisOne,b.before.nextSibling);break;default:"append"==b.how&&$(b.active).append(b.thisOne),"prepend"==b.how&&$(b.active).prepend(b.thisOne),"html"==b.how&&$(b.active).html(b.thisOne)}return!0};b.bind("insert",function(c){var d=b.insertCallback,e=!0;"true"==
b.attr("rCheck")&&(g.check("INSERT")||(e=!1));e?b.beforeInsert.apply(b,[c])&&d.apply(b,[c])&&($(document).trigger({type:"insertdone",entityId:b.UId}),b.afterInsert.apply(b,[c])):alert("jqForms: INSERT not allowed")});b.insert=function(c){c=$.extend({},{type:"insert"},c);b.trigger(c)};b.updateCallback=function(c){b.dataSourceInitialized&&(c=c.which,c.children("ul:eq(0)"),c=c.get(0).documentRef,c instanceof Node&&"function"==typeof c.hasChildNodes&&c.hasChildNodes()&&$(c.childNodes).each(function(){switch(this.nodeType){case 1:var c=
this.hasAttribute(b.runtimeOptions.showThisAttributeInsteadTreeNodeName.value)&&""!=this.getAttribute(b.o.showThisAttributeInsteadTreeNodeName)?this.getAttribute(b.runtimeOptions.showThisAttributeInsteadTreeNodeName.value):this.nodeName,e=this.hasChildNodes()?"node":"leaf";break;default:c=this.nodeName,e="leaf"}g.treeDisplayFilter(this)&&(b.runtimeOptions.showDOMElementsOnly.value?1==this.nodeType&&b.tree.kvaTree.AddNodeTo(c,e,this):b.tree.kvaTree.AddNodeTo(c,e,this))}));return!0};b.on("populate",
function(c){var d=b.updateCallback,e=!0;"true"==b.attr("rCheck")&&(g.check("UPDATE")||(e=!1));e?b.beforeUpdate.apply(b)&&d.apply(b,[c])&&($(document).trigger({type:"populatedone",entityId:b.UId}),b.afterUpdate.apply(b)):alert("jqForms: UPDATE not allowed")});b.update=function(c){c=$.extend({},{type:"populate"},c);b.trigger(c)};g.autoinit&&b.init();g.alterDOM&&$.extend(A,{jqf:b,UID:b.UId});return this};
